<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.taobao.cun.auge.dal.mapper.CuntaoAssetFlowExtMapper" >
 
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where >
     and o.is_deleted ='n' and o.id=a. apply_org  AND a.is_deleted= 'n' 
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="and (" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and <![CDATA[a.]]>${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and <![CDATA[a.]]>${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and <![CDATA[a.]]>${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and <![CDATA[a.]]>${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  
  <select id="selectByExample" resultMap="com.taobao.cun.auge.dal.mapper.CuntaoAssetFlowMapper.BaseResultMap" parameterType="com.taobao.cun.auge.dal.domain.CuntaoAssetFlowExtExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    'true' as QUERYID,
    a.*
    from cuntao_asset_flow a,cuntao_org o 
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="fullIdPath != null" >
		AND <![CDATA[concat(o.temp_full_id_path,'/') like concat('${fullIdPath}','/%')]]>
	 </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  
  <select id="getApplyAssetCount" parameterType="map"  resultType="map" >
	select cafd.name as name,sum(cafd.apply_num) as categoryCount 
	from  cuntao_asset_flow_detail cafd,cuntao_asset_flow caf 
	where cafd.apply_id=caf.id 
	and cafd.is_deleted='n' 
	and caf.is_deleted='n' 
	<if test="applyOrg != null">
		AND <![CDATA[ caf.apply_org = #applyOrg#]]>
	 </if>
	 <if test="applyStatusArray != null">
	  AND  caf.apply_status  in
	  	  <foreach item="item" collection="applyStatusArray" separator="," open="(" close=")" index="">
	       #{item}
	     </foreach>
	 </if>
	 <if test="applyStatus != null">
	   AND  <![CDATA[ caf.apply_status  = #applyStatus#]]>
	</if>
	group by cafd.name
	</select>
  
  
  <select id="selectForExcel" resultType="com.taobao.cun.auge.dal.domain.CuntaoAssetFlowDetailForExcel"  parameterType="com.taobao.cun.auge.dal.domain.CuntaoAssetFlowDetailForExcel" >
	SELECT cafd.name, 
	       cafd.apply_num as applyNum, 
	       cafd.type, 
	       cafd.sku, 
	       caf.apply_org_desc as applyOrgDesc, 
	       caf.applier, 
	       caf.applier_no as applierNo,
	       caf.apply_time as applyTime, 
	       caf.plan_receive_time as planReceiveTime, 
	       caf.receiver, 
	       caf.mobile, 
	       caf.apply_status as applyStatus, 
	       caf.purchase_status as purchaseStatus, 
	       caf.asset_owner as assetOwner, 
	       caf.asset_owner_no  as assetOwnerNo, 
	       caf.receive_address as receiveAddress, 
	       caf.remark, 
	       caf.id as applyId
	FROM cuntao_asset_flow_detail cafd, cuntao_asset_flow caf, cuntao_org org
	WHERE cafd.apply_id = caf.id
	AND cafd.is_deleted = 'n'
	AND caf.is_deleted = 'n'
	and caf.apply_org=org.id
		<if test="applierNo != null">
			AND caf.applier_no=#applierNo#
		 </if>
		 <if test="purchaseStatus != null">
			AND caf.purchase_status=#purchaseStatus#
		 </if>
		 <if test="planReceiveTimeBegin != null">
			AND <![CDATA[caf.plan_receive_time >= #planReceiveTimeBegin#]]>
		</if>
		 <if test="planReceiveTimeEnd != null">
			AND <![CDATA[caf.plan_receive_time <= #planReceiveTimeEnd#]]>
		</if>
		 <if test="applyIdArray != null">
	   	AND  caf.id  in
	   	  <foreach item="item" collection="applyIdArray" separator="," open="(" close=")" index="">
	       #{item}
	     </foreach>
		</if>
		 <if test="orgIdArray != null">
	   AND caf.apply_org  in
	    <foreach item="item" collection="orgIdArray" separator="," open="(" close=")" index="">
	       #{item}
	     </foreach>
		</if>
		 <if test="fullIdPath != null">
		AND <![CDATA[concat(org.temp_full_id_path,'/') like concat(#fullIdPath#,'/%')]]>
		</if>
</select>

<select id="selectCountForExcel" resultType="java.lang.Integer"  parameterType="com.taobao.cun.auge.dal.domain.CuntaoAssetFlowDetailForExcel" >
	SELECT count(1)
	FROM cuntao_asset_flow_detail cafd, cuntao_asset_flow caf, cuntao_org org
	WHERE cafd.apply_id = caf.id
	AND cafd.is_deleted = 'n'
	AND caf.is_deleted = 'n'
	and caf.apply_org=org.id
	 	<if test="applierNo != null">
		AND	caf.applier_no=#applierNo#
		</if>
		<if test="purchaseStatus != null">
		AND	caf.purchase_status=#purchaseStatus#
		</if>
		<if test="planReceiveTimeBegin != null">
			AND <![CDATA[caf.plan_receive_time >= #planReceiveTimeBegin#]]>
		</if>
		<if test="planReceiveTimeEnd != null">
			AND <![CDATA[caf.plan_receive_time <= #planReceiveTimeEnd#]]>
		</if>
		<if test="applyIdArray != null">
	    AND caf.id  in
	     <foreach item="item" collection="applyIdArray" separator="," open="(" close=")" index="">
			#applyIdArray[]# 
         </foreach>
	</if>
	<if test="orgIdArray != null">
	   AND caf.apply_org  in
	     <foreach item="item" collection="orgIdArray" separator="," open="(" close=")" index="">
	       #{item}
	     </foreach>
	</if>
	<if test="fullIdPath != null">
		AND <![CDATA[concat(org.temp_full_id_path,'/') like concat(#fullIdPath#,'/%')]]>
	</if>
</select>

</mapper>