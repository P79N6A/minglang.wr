<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.taobao.cun.auge.dal.mapper.CuntaoQualificationExtMapper" >
  <resultMap id="BaseResultMap" type="com.taobao.cun.auge.dal.domain.CuntaoQualification" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="gmt_create" property="gmtCreate" jdbcType="TIMESTAMP" />
    <result column="gmt_modified" property="gmtModified" jdbcType="TIMESTAMP" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="modifier" property="modifier" jdbcType="VARCHAR" />
    <result column="partner_instance_id" property="partnerInstanceId" jdbcType="BIGINT" />
    <result column="taobao_user_id" property="taobaoUserId" jdbcType="BIGINT" />
    <result column="quali_no" property="qualiNo" jdbcType="VARCHAR" />
    <result column="company_name" property="companyName" jdbcType="VARCHAR" />
    <result column="legal_person" property="legalPerson" jdbcType="VARCHAR" />
    <result column="enterprice_type_desc" property="enterpriceTypeDesc" jdbcType="VARCHAR" />
    <result column="quali_start_time" property="qualiStartTime" jdbcType="VARCHAR" />
    <result column="quali_end_time" property="qualiEndTime" jdbcType="VARCHAR" />
    <result column="enterprice_type" property="enterpriceType" jdbcType="INTEGER" />
    <result column="regsiter_address" property="regsiterAddress" jdbcType="VARCHAR" />
    <result column="biz_scope" property="bizScope" jdbcType="VARCHAR" />
    <result column="operation_status" property="operationStatus" jdbcType="VARCHAR" />
    <result column="agencies" property="agencies" jdbcType="VARCHAR" />
    <result column="quali_pic" property="qualiPic" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="invalid_time" property="invalidTime" jdbcType="TIMESTAMP" />
    <result column="quali_info_id" property="qualiInfoId" jdbcType="BIGINT" />
    <result column="quali_id" property="qualiId" jdbcType="BIGINT" />
    <result column="eid_type" property="eidType" jdbcType="INTEGER" />
    <result column="eid" property="eid" jdbcType="VARCHAR" />
    <result column="submit_time" property="submitTime" jdbcType="TIMESTAMP" />
    <result column="audit_time" property="auditTime" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="VARCHAR" />
  </resultMap>
  
   <select id="queryQualification" resultMap="BaseResultMap" parameterType="com.taobao.cun.auge.station.condition.CuntaoQualificationPageCondition" >
	select cq.* from partner_station_rel psr,cuntao_qualification cq,station s,cuntao_org org where psr.is_deleted = 'n' and s.is_deleted = 'n' 
		and psr.is_current='y'  and cq.is_deleted ='n' and s.apply_org = org.id
		and cq.partner_instance_id = psr.id  and psr.station_id = s.id
		<include refid="query_condition" />  
  </select>
 
  <sql id="query_condition" >
  		<if test="invalidPartnerInstanceStatus != null and  invalidPartnerInstanceStatus.size() != 0" >
			and psr.state  not in 
			<foreach collection="invalidPartnerInstanceStatus" item="status" open="(" close=")" separator="," >
				#{status}
			</foreach>
		</if>
		<if test="userTypes != null and  userTypes.size() != 0" >
			and psr.type   in 
			<foreach collection="userTypes" item="userType" open="(" close=")" separator="," >
				#{userType}
			</foreach>
		</if>
		<if test="orgIdPaths != null and  orgIdPaths.size() != 0" >
			and
			<foreach collection="orgIdPaths" item="orgIdPath" open="(" close=")" separator="or" >
				 concat(org.temp_full_id_path, '/') like concat(#{orgIdPath,jdbcType=VARCHAR}, '/%')
			</foreach>
		</if>
  </sql>
  
  
   <select id="selectC2BTestUsers" resultType="java.lang.Long"  parameterType="com.taobao.cun.auge.station.condition.CuntaoQualificationPageCondition" >
   		select psr.taobao_user_id from partner_station_rel psr,station s
		where psr.is_deleted= 'n' 
		and s.is_deleted= 'n'
		and psr.station_id = s.id
		and s.apply_org = org.id
	    <include refid="query_condition" />  
   </select>
</mapper>