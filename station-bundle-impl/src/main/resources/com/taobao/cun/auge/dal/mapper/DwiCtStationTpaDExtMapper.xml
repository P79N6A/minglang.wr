<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.taobao.cun.auge.dal.mapper.DwiCtStationTpaDExtMapper" >
  <resultMap id="BaseResultMap" type="com.taobao.cun.auge.dal.domain.DwiCtStationTpaD" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="stat_date" property="statDate" jdbcType="VARCHAR" />
    <result column="dw_ins_time" property="dwInsTime" jdbcType="VARCHAR" />
    <result column="biz_month" property="bizMonth" jdbcType="VARCHAR" />
    <result column="county_org_id" property="countyOrgId" jdbcType="VARCHAR" />
    <result column="county_org_name" property="countyOrgName" jdbcType="VARCHAR" />
    <result column="station_id" property="stationId" jdbcType="BIGINT" />
    <result column="station_name" property="stationName" jdbcType="VARCHAR" />
    <result column="partner_station_id" property="partnerStationId" jdbcType="BIGINT" />
    <result column="partner_station_name" property="partnerStationName" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="srvc_day_cnt_mtd" property="srvcDayCntMtd" jdbcType="BIGINT" />
    <result column="pay_mord_cnt_mtd_023" property="payMordCntMtd023" jdbcType="BIGINT" />
    <result column="pay_ord_amt_mtd_001" property="payOrdAmtMtd001" jdbcType="DECIMAL" />
    <result column="pay_mord_cnt_mtd_015" property="payMordCntMtd015" jdbcType="BIGINT" />
    <result column="pay_ord_amt_mtd_587" property="payOrdAmtMtd587" jdbcType="DECIMAL" />
  </resultMap>
  <select id="selectStationsByExample" resultMap="BaseResultMap" parameterType="com.taobao.cun.auge.dal.example.DwiCtStationTpaDExtExample" >
		select 
		    id, 
		    stat_date, 
		    dw_ins_time, 
		    max(biz_month) as biz_month, 
		    county_org_id, 
		    county_org_name, 
		    station_id, 
		    station_name, 
		    partner_station_id, 
		    partner_station_name, 
		    state, 
		    srvc_day_cnt_mtd, 
		    pay_mord_cnt_mtd_023, 
		    pay_ord_amt_mtd_001, 
		    pay_mord_cnt_mtd_015, 
		    pay_ord_amt_mtd_587
		
		from dwi_ct_station_tpa_d where 
			<include refid="query_condition" />  
		group by station_id 
		<if test="lastMonthCount != null" >
		    having count(station_id) = #{lastMonthCount}
		</if>
  </select>
  <sql id="query_condition" >
  		<if test="bizMonths != null" >
			biz_month in 
			<foreach collection="bizMonths" item="bizMonth" open="(" close=")" separator="," >
				#{bizMonth}
			</foreach>
		</if>
		<if test="orderNumLimit != null" >
			<![CDATA[and pay_mord_cnt_mtd_023 < #{orderNumLimit} ]]>
		</if>
		<if test="gmvLimit != null" >
			<![CDATA[and pay_ord_amt_mtd_001 < #{gmvLimit} ]]>
		</if>
  </sql>
</mapper>