<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.taobao.cun.auge.dal.mapper.DwiCtStationTpaIncomeMExtMapper">
  <resultMap id="BaseResultMap" type="com.taobao.cun.auge.dal.domain.DwiCtStationTpaIncomeM" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 15 15:50:59 GMT+08:00 2016.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="stat_date" property="statDate" jdbcType="VARCHAR" />
    <result column="biz_month" property="bizMonth" jdbcType="VARCHAR" />
    <result column="county_org_id" property="countyOrgId" jdbcType="VARCHAR" />
    <result column="county_org_name" property="countyOrgName" jdbcType="VARCHAR" />
    <result column="station_id" property="stationId" jdbcType="BIGINT" />
    <result column="station_name" property="stationName" jdbcType="VARCHAR" />
    <result column="tpa_srvc_cnt_1d" property="tpaSrvcCnt1d" jdbcType="BIGINT" />
    <result column="ct_srvc_tpa_income_est_fee_amt_mtd" property="ctSrvcTpaIncomeEstFeeAmtMtd" jdbcType="DECIMAL" />
    <result column="ct_srvc_tpa_income_est_fee_amt_avg_mtd" property="ctSrvcTpaIncomeEstFeeAmtAvgMtd" jdbcType="DECIMAL" />
    <result column="station_srvc_cnt" property="stationSrvcCnt" jdbcType="BIGINT" />
    <result column="ct_srvc_tpa_income_est_fee_amt_avg_rank_mtd" property="ctSrvcTpaIncomeEstFeeAmtAvgRankMtd" jdbcType="BIGINT" />
  </resultMap>
  
  <select id="selectStationsByExample" resultMap="BaseResultMap" parameterType="com.taobao.cun.auge.dal.example.DwiCtStationTpaIncomeMExmple" >
		select  * from (
			select  * from dwi_ct_station_tpa_income_m where <include refid="query_condition" /> order by biz_month desc
		) as temp group by station_id 
		<if test="lastMonthCount != null" >
		    having count(station_id) = lastMonthCount
		</if>
  </select>
  <sql id="query_condition" >
  		<if test="bizMonths != null" >
			and biz_month in 
			<foreach collection="bizMonths" item="bizMonth" open="(" close=")" separator="," >
				#{bizMonth}
			</foreach>
		</if>
		
		<if test="scale != null" >
		    and ct_srvc_tpa_income_est_fee_amt_avg_rank_mtd/station_srvc_cnt< scale
		</if>
  </sql>
</mapper>